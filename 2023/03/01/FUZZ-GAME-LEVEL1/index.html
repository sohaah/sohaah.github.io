<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Fuzzing101项目地址：https:&#x2F;&#x2F;github.com&#x2F;antonio-morales&#x2F;Fuzzing101 详细配置网上都有教程。记录一下踩的坑吧，尽量在fuzz的时候选择平台选择kali，ubuntu特别是22版本坑尤其多（为啥？因为我折腾了一天折磨惨了，换了kali就像拉屎一样顺畅（：就成功了，在配置afl和系统变量CC和CCX的时候很容易失败导致插桩出现问题，麻了，同时一定注意">
<meta property="og:type" content="article">
<meta property="og:title" content="Fuzz_Game_Level1：fuzzing101Lab系列">
<meta property="og:url" content="http://example.com/2023/03/01/FUZZ-GAME-LEVEL1/index.html">
<meta property="og:site_name" content="Osaa&#39;s blog">
<meta property="og:description" content="Fuzzing101项目地址：https:&#x2F;&#x2F;github.com&#x2F;antonio-morales&#x2F;Fuzzing101 详细配置网上都有教程。记录一下踩的坑吧，尽量在fuzz的时候选择平台选择kali，ubuntu特别是22版本坑尤其多（为啥？因为我折腾了一天折磨惨了，换了kali就像拉屎一样顺畅（：就成功了，在配置afl和系统变量CC和CCX的时候很容易失败导致插桩出现问题，麻了，同时一定注意">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-03-01T13:32:10.000Z">
<meta property="article:modified_time" content="2023-09-12T12:57:36.682Z">
<meta property="article:author" content="Osaa">
<meta property="article:tag" content="fuzz">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2023/03/01/FUZZ-GAME-LEVEL1/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Fuzz_Game_Level1：fuzzing101Lab系列 | Osaa's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Osaa's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-friends">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>Friends</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/03/01/FUZZ-GAME-LEVEL1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/image/cat.png">
      <meta itemprop="name" content="Osaa">
      <meta itemprop="description" content="Try to do something interesting">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Osaa's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Fuzz_Game_Level1：fuzzing101Lab系列
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-03-01 21:32:10" itemprop="dateCreated datePublished" datetime="2023-03-01T21:32:10+08:00">2023-03-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-09-12 20:57:36" itemprop="dateModified" datetime="2023-09-12T20:57:36+08:00">2023-09-12</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Fuzzing101"><a href="#Fuzzing101" class="headerlink" title="Fuzzing101"></a>Fuzzing101</h2><p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/antonio-morales/Fuzzing101">https://github.com/antonio-morales/Fuzzing101</a></p>
<p>详细配置网上都有教程。记录一下踩的坑吧，尽量在fuzz的时候选择平台选择kali，ubuntu特别是22版本坑尤其多（为啥？因为我折腾了一天折磨惨了，换了kali就像拉屎一样顺畅（：就成功了，在配置afl和系统变量CC和CCX的时候很容易失败导致插桩出现问题，麻了，同时一定注意在配置环境变量LLVM_CONFIG的时候一定不要有多的空格，这个出错了很难发现：export LLVM_CONFIG&#x3D;”llvm-config-11”）</p>
<span id="more"></span>

<h3 id="Fuzzing101-Libexif"><a href="#Fuzzing101-Libexif" class="headerlink" title="Fuzzing101 Libexif"></a>Fuzzing101 Libexif</h3><p>着重记录一下fuzz的参数: -i:指定输入文件夹 -o指定输出文件夹 -s：固定变异数据 -：分割符 @@：指代文件，如果不加就是标准输入</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">ex:</span><br><span class="line">/home/osaa/桌面/fuzz/AFLplusplus/afl-fuzz -i /home/osaa/桌面/fuzz/fuzzing_libexif/exif-samples-master/jpg -o /home/osaa/桌面/fuzz/fuzzing_libexif/out -s <span class="number">123</span> /home/osaa/桌面/fuzz/fuzzing_libexif/install/bin/exif @@</span><br><span class="line"></span><br><span class="line">result：</span><br><span class="line">american fuzzy lop ++<span class="number">4.06</span>a &#123;<span class="keyword">default</span>&#125; (...ng_libexif/install/bin/exif) [fast]</span><br><span class="line">┌─ process timing ────────────────────────────────────┬─ overall results ────┐</span><br><span class="line">│        run time : <span class="number">0</span> days, <span class="number">0</span> hrs, <span class="number">10</span> min, <span class="number">40</span> sec     │  cycles done : <span class="number">0</span>     │</span><br><span class="line">│   last <span class="keyword">new</span> find : <span class="number">0</span> days, <span class="number">0</span> hrs, <span class="number">0</span> min, <span class="number">24</span> sec      │ corpus count : <span class="number">621</span>   │</span><br><span class="line">│last saved crash : <span class="number">0</span> days, <span class="number">0</span> hrs, <span class="number">0</span> min, <span class="number">59</span> sec      │saved crashes : <span class="number">12</span>    │</span><br><span class="line">│ last saved hang : <span class="number">0</span> days, <span class="number">0</span> hrs, <span class="number">3</span> min, <span class="number">18</span> sec      │  saved hangs : <span class="number">1</span>     │</span><br><span class="line">├─ cycle progress ─────────────────────┬─ map coverage┴──────────────────────┤</span><br><span class="line">│  now processing : <span class="number">593</span>*<span class="number">1</span> (<span class="number">95.5</span>%)      │    map density : <span class="number">0.44</span>% / <span class="number">1.14</span>%      │</span><br><span class="line">│  runs timed out : <span class="number">0</span> (<span class="number">0.00</span>%)          │ count coverage : <span class="number">3.12</span> bits/tuple    │</span><br><span class="line">├─ stage progress ─────────────────────┼─ findings in depth ─────────────────┤</span><br><span class="line">│  now trying : splice <span class="number">4</span>               │ favored items : <span class="number">121</span> (<span class="number">19.48</span>%)        │</span><br><span class="line">│ stage execs : <span class="number">4</span>/<span class="number">50</span> (<span class="number">8.00</span>%)           │  <span class="keyword">new</span> edges on : <span class="number">170</span> (<span class="number">27.38</span>%)        │</span><br><span class="line">│ total execs : <span class="number">591</span>k                   │ total crashes : <span class="number">55</span> (<span class="number">12</span> saved)       │</span><br><span class="line">│  exec speed : <span class="number">1188</span>/sec               │  total tmouts : <span class="number">13</span> (<span class="number">0</span> saved)        │</span><br><span class="line">├─ fuzzing strategy yields ────────────┴─────────────┬─ item geometry ───────┤</span><br><span class="line">│   bit flips : <span class="built_in">disabled</span> (<span class="keyword">default</span>, enable with -D)   │    levels : <span class="number">10</span>        │</span><br><span class="line">│  byte flips : <span class="built_in">disabled</span> (<span class="keyword">default</span>, enable with -D)   │   pending : <span class="number">434</span>       │</span><br><span class="line">│ arithmetics : <span class="built_in">disabled</span> (<span class="keyword">default</span>, enable with -D)   │  pend fav : <span class="number">3</span>         │</span><br><span class="line">│  known ints : <span class="built_in">disabled</span> (<span class="keyword">default</span>, enable with -D)   │ own finds : <span class="number">527</span>       │</span><br><span class="line">│  dictionary : n/a                                  │  imported : <span class="number">0</span>         │</span><br><span class="line">│havoc/splice : <span class="number">452</span>/<span class="number">334</span>k, <span class="number">87</span>/<span class="number">118</span>k                    │ stability : <span class="number">100.00</span>%   │</span><br><span class="line">│py/custom/rq : unused, unused, unused, unused       ├───────────────────────┘</span><br><span class="line">│    trim/eff : <span class="number">74.94</span>%/<span class="number">134</span>k, disabled                │          [cpu000: <span class="number">50</span>%]</span><br><span class="line">└────────────────────────────────────────────────────┘^C</span><br><span class="line"></span><br><span class="line">+++ Testing aborted by user +++</span><br><span class="line">[+] We<span class="number">&#x27;</span>re done here. Have a nice day!</span><br></pre></td></tr></table></figure>

<p>同时在crashs中我们可以直接用gdb更上调试跟踪溢出点</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">ex:</span><br><span class="line">gdb --args ./exif /home/osaa/桌面/fuzz/fuzzing_libexif/out/<span class="keyword">default</span>/crashes/id:<span class="number">000000</span>,sig:<span class="number">11</span>,src:<span class="number">000181</span>+<span class="number">000232</span>,time:<span class="number">33959</span>,execs:<span class="number">34578</span>,op:splice,rep:<span class="number">8</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"> result:</span><br><span class="line"><span class="number">87</span> <span class="built_in">exif_get_sshort</span> (<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span> *buf, ExifByteOrder order)</span><br><span class="line">   <span class="number">88</span> &#123;</span><br><span class="line">   <span class="number">89</span>         <span class="keyword">if</span> (!buf) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">   <span class="number">90</span>         <span class="keyword">switch</span> (order) &#123;</span><br><span class="line">   <span class="number">91</span>         <span class="keyword">case</span> EXIF_BYTE_ORDER_MOTOROLA:</span><br><span class="line"> ► <span class="number">92</span>                 <span class="keyword">return</span> ((buf[<span class="number">0</span>] &lt;&lt; <span class="number">8</span>) | buf[<span class="number">1</span>]);</span><br><span class="line">   <span class="number">93</span>         <span class="keyword">case</span> EXIF_BYTE_ORDER_INTEL:</span><br><span class="line">   <span class="number">94</span>                 <span class="keyword">return</span> ((buf[<span class="number">1</span>] &lt;&lt; <span class="number">8</span>) | buf[<span class="number">0</span>]);</span><br><span class="line">   <span class="number">95</span>         &#125;</span><br><span class="line">   <span class="number">96</span> </span><br><span class="line">   <span class="number">97</span>         <span class="comment">/* Won&#x27;t be reached */</span></span><br><span class="line">────────────────────────────────────────────[ STACK ]────────────────────────────────────────────</span><br><span class="line"><span class="number">00</span>:<span class="number">0000</span>│ rsp <span class="number">0x7fffffffd5d8</span> —▸ <span class="number">0x555555566e15</span> (exif_data_load_data+<span class="number">1349</span>) ◂— movzx eax, ax</span><br><span class="line"><span class="number">01</span>:<span class="number">0008</span>│     <span class="number">0x7fffffffd5e0</span> —▸ <span class="number">0x5555557a01e8</span> —▸ <span class="number">0x5555557a0200</span> ◂— <span class="number">0x0</span></span><br><span class="line"><span class="number">02</span>:<span class="number">0010</span>│     <span class="number">0x7fffffffd5e8</span> ◂— <span class="number">0x47e555652ea</span></span><br><span class="line"><span class="number">03</span>:<span class="number">0018</span>│     <span class="number">0x7fffffffd5f0</span> —▸ <span class="number">0x55555579fd26</span> ◂— <span class="number">0xfbffffff2a004d4d</span> <span class="comment">/* &#x27;MM&#x27; */</span></span><br><span class="line"><span class="number">04</span>:<span class="number">0020</span>│     <span class="number">0x7fffffffd5f8</span> —▸ <span class="number">0x55555579fcd0</span> ◂— <span class="number">0x100000006</span></span><br><span class="line"><span class="number">05</span>:<span class="number">0028</span>│     <span class="number">0x7fffffffd600</span> —▸ <span class="number">0x55555559a250</span> (__afl_area_ptr) —▸ <span class="number">0x55555559d3c0</span> (__afl_area_initial) ◂— <span class="number">0x0</span>                                                                                      </span><br><span class="line"><span class="number">06</span>:<span class="number">0030</span>│     <span class="number">0x7fffffffd608</span> —▸ <span class="number">0x55555579f7a0</span> —▸ <span class="number">0x55555579fbb0</span> ◂— <span class="number">0x736f2f656d6f682f</span> (<span class="string">&#x27;/home/os&#x27;</span>)</span><br><span class="line"><span class="number">07</span>:<span class="number">0038</span>│     <span class="number">0x7fffffffd610</span> —▸ <span class="number">0x5555557a01b0</span> —▸ <span class="number">0x5555557a0240</span> ◂— <span class="number">0x0</span></span><br><span class="line">──────────────────────────────────────────[ BACKTRACE ]──────────────────────────────────────────</span><br><span class="line"> ► f <span class="number">0</span>   <span class="number">0x5555555735fb</span> exif_get_short+<span class="number">107</span></span><br><span class="line">   f <span class="number">1</span>   <span class="number">0x5555555735fb</span> exif_get_short+<span class="number">107</span></span><br><span class="line">   f <span class="number">2</span>   <span class="number">0x555555566e15</span> exif_data_load_data+<span class="number">1349</span></span><br><span class="line">   f <span class="number">3</span>   <span class="number">0x5555555700a4</span> exif_loader_get_data+<span class="number">100</span></span><br><span class="line">   f <span class="number">4</span>   <span class="number">0x555555561337</span> main+<span class="number">2279</span></span><br><span class="line">   f <span class="number">5</span>   <span class="number">0x7ffff7d0818a</span> __libc_start_call_main+<span class="number">122</span></span><br><span class="line">   f <span class="number">6</span>   <span class="number">0x7ffff7d08245</span> __libc_start_main+<span class="number">133</span></span><br><span class="line">   f <span class="number">7</span>   <span class="number">0x55555555f5a1</span> _start+<span class="number">33</span></span><br><span class="line">─────────────────────────────────────────────────────────────────────────────────</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>另外记录一个科学上网linux： git clone <a target="_blank" rel="noopener" href="https://github.com/wanhebin/clash-for-linux.git">https://github.com/wanhebin/clash-for-linux.git</a> 好用0.o（注意在使用sh可能无法执行启动脚本，换为&#x2F;bin&#x2F;bash start.sh 原因详见github issue）</p>
<h3 id="Fuzzing101-TCPdump"><a href="#Fuzzing101-TCPdump" class="headerlink" title="Fuzzing101-TCPdump"></a>Fuzzing101-TCPdump</h3><p>流程与前面的Fuzzing101都一样，但是学会使用AFL_USE_ASEN参数设置，这里引用一下AFL_USE_ASEN的解释</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">读取环境变量``AFL_USE_ASAN`和`AFL_USE_MSAN`的值，如果其中有一个为1，则设置`sanitizer`为1，且将`inst_ratio`除3。这是因为在进行ASAN的编译时，AFL无法识别出ASAN特定的分支，导致插入很多无意义的桩代码，所以直接暴力地将插桩概率/3；</span><br></pre></td></tr></table></figure>

<p>同时注意在运行fuzz的时候参数加入-m none，因为在ASEN模式下对内存消耗很大，禁用内存限制</p>
<h3 id="Fuzzing101-LibTIFF"><a href="#Fuzzing101-LibTIFF" class="headerlink" title="Fuzzing101 - LibTIFF"></a>Fuzzing101 - LibTIFF</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">result:</span><br><span class="line"></span><br><span class="line"> american fuzzy lop ++<span class="number">4.06</span>a &#123;<span class="keyword">default</span>&#125; (...g_tiff/install/bin/tiffinfo) [fast]</span><br><span class="line">┌─ process timing ────────────────────────────────────┬─ overall results ────┐</span><br><span class="line">│        run time : <span class="number">0</span> days, <span class="number">0</span> hrs, <span class="number">9</span> min, <span class="number">25</span> sec      │  cycles done : <span class="number">0</span>     │</span><br><span class="line">│   last <span class="keyword">new</span> find : <span class="number">0</span> days, <span class="number">0</span> hrs, <span class="number">0</span> min, <span class="number">3</span> sec       │ corpus count : <span class="number">555</span>   │</span><br><span class="line">│last saved crash : <span class="number">0</span> days, <span class="number">0</span> hrs, <span class="number">0</span> min, <span class="number">0</span> sec       │saved crashes : <span class="number">30</span>    │</span><br><span class="line">│ last saved hang : <span class="number">0</span> days, <span class="number">0</span> hrs, <span class="number">7</span> min, <span class="number">4</span> sec       │  saved hangs : <span class="number">2</span>     │</span><br><span class="line">├─ cycle progress ─────────────────────┬─ map coverage┴──────────────────────┤</span><br><span class="line">│  now processing : <span class="number">340.2</span> (<span class="number">61.3</span>%)      │    map density : <span class="number">0.35</span>% / <span class="number">1.89</span>%      │</span><br><span class="line">│  runs timed out : <span class="number">0</span> (<span class="number">0.00</span>%)          │ count coverage : <span class="number">2.14</span> bits/tuple    │</span><br><span class="line">├─ stage progress ─────────────────────┼─ findings in depth ─────────────────┤</span><br><span class="line">│  now trying : havoc                  │ favored items : <span class="number">180</span> (<span class="number">32.43</span>%)        │</span><br><span class="line">│ stage execs : <span class="number">117</span>/<span class="number">228</span> (<span class="number">51.32</span>%)       │  <span class="keyword">new</span> edges on : <span class="number">273</span> (<span class="number">49.19</span>%)        │</span><br><span class="line">│ total execs : <span class="number">667</span>k                   │ total crashes : <span class="number">56</span> (<span class="number">30</span> saved)       │</span><br><span class="line">│  exec speed : <span class="number">1069</span>/sec               │  total tmouts : <span class="number">1881</span> (<span class="number">0</span> saved)      │</span><br><span class="line">├─ fuzzing strategy yields ────────────┴─────────────┬─ item geometry ───────┤</span><br><span class="line">│   bit flips : <span class="built_in">disabled</span> (<span class="keyword">default</span>, enable with -D)   │    levels : <span class="number">7</span>         │</span><br><span class="line">│  byte flips : <span class="built_in">disabled</span> (<span class="keyword">default</span>, enable with -D)   │   pending : <span class="number">380</span>       │</span><br><span class="line">│ arithmetics : <span class="built_in">disabled</span> (<span class="keyword">default</span>, enable with -D)   │  pend fav : <span class="number">92</span>        │</span><br><span class="line">│  known ints : <span class="built_in">disabled</span> (<span class="keyword">default</span>, enable with -D)   │ own finds : <span class="number">538</span>       │</span><br><span class="line">│  dictionary : n/a                                  │  imported : <span class="number">0</span>         │</span><br><span class="line">│havoc/splice : <span class="number">514</span>/<span class="number">375</span>k, <span class="number">54</span>/<span class="number">97.8</span>k                   │ stability : <span class="number">100.00</span>%   │</span><br><span class="line">│py/custom/rq : unused, unused, unused, unused       ├───────────────────────┘</span><br><span class="line">│    trim/eff : <span class="number">1.88</span>%/<span class="number">190</span>k, disabled                 │          [cpu000: <span class="number">50</span>%]</span><br><span class="line">└────────────────────────────────────────────────────┘^C</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">ASAN_result:</span><br><span class="line"></span><br><span class="line">    =================================================================</span><br><span class="line">==<span class="number">2688234</span>==ERROR: AddressSanitizer: heap-buffer-overflow on address <span class="number">0x602000000071</span> at pc <span class="number">0x55ec6f1d24e1</span> bp <span class="number">0x7ffceb971fb0</span> sp <span class="number">0x7ffceb971778</span></span><br><span class="line">READ of size <span class="number">2</span> at <span class="number">0x602000000071</span> thread T0</span><br><span class="line">    #<span class="number">0</span> <span class="number">0x55ec6f1d24e0</span> in <span class="built_in">fputs</span> (/home/osaa/桌面/fuzz/fuzzing_tiff/install/bin/tiffinfo+<span class="number">0x614e0</span>) (BuildId: <span class="number">09</span>ddfdfe67d478d303d725e7968d407c632d1072)</span><br><span class="line">    #<span class="number">1</span> <span class="number">0x55ec6f2c5051</span> in _TIFFPrintField /home/osaa/桌面/fuzz/fuzzing_tiff/tiff<span class="number">-4.0</span><span class="number">.4</span>/libtiff/tif_print.c:<span class="number">127</span>:<span class="number">4</span></span><br><span class="line">    #<span class="number">2</span> <span class="number">0x55ec6f2c5051</span> in TIFFPrintDirectory /home/osaa/桌面/fuzz/fuzzing_tiff/tiff<span class="number">-4.0</span><span class="number">.4</span>/libtiff/tif_print.c:<span class="number">641</span>:<span class="number">5</span></span><br><span class="line">    #<span class="number">3</span> <span class="number">0x55ec6f273e38</span> in tiffinfo /home/osaa/桌面/fuzz/fuzzing_tiff/tiff<span class="number">-4.0</span><span class="number">.4</span>/tools/tiffinfo.c:<span class="number">449</span>:<span class="number">2</span></span><br><span class="line">    #<span class="number">4</span> <span class="number">0x55ec6f2737e6</span> in main /home/osaa/桌面/fuzz/fuzzing_tiff/tiff<span class="number">-4.0</span><span class="number">.4</span>/tools/tiffinfo.c:<span class="number">152</span>:<span class="number">6</span></span><br><span class="line">    #<span class="number">5</span> <span class="number">0x7f41f3241189</span> in __libc_start_call_main csu/../sysdeps/nptl/libc_start_call_main.h:<span class="number">58</span>:<span class="number">16</span></span><br><span class="line">    #<span class="number">6</span> <span class="number">0x7f41f3241244</span> in __libc_start_main csu/../csu/libc-start.c:<span class="number">381</span>:<span class="number">3</span></span><br><span class="line">    #<span class="number">7</span> <span class="number">0x55ec6f1b5570</span> in _start (/home/osaa/桌面/fuzz/fuzzing_tiff/install/bin/tiffinfo+<span class="number">0x44570</span>) (BuildId: <span class="number">09</span>ddfdfe67d478d303d725e7968d407c632d1072)</span><br><span class="line"></span><br><span class="line"><span class="number">0x602000000071</span> is located <span class="number">0</span> bytes to the right of <span class="number">1</span>-byte region [<span class="number">0x602000000070</span>,<span class="number">0x602000000071</span>)</span><br><span class="line">allocated by thread T0 here:                                                                     </span><br><span class="line">    #<span class="number">0</span> <span class="number">0x55ec6f2383be</span> in __interceptor_malloc (/home/osaa/桌面/fuzz/fuzzing_tiff/install/bin/tiffinfo+<span class="number">0xc73be</span>) (BuildId: <span class="number">09</span>ddfdfe67d478d303d725e7968d407c632d1072)</span><br><span class="line">    #<span class="number">1</span> <span class="number">0x55ec6f27b674</span> in setByteArray /home/osaa/桌面/fuzz/fuzzing_tiff/tiff<span class="number">-4.0</span><span class="number">.4</span>/libtiff/tif_dir.c:<span class="number">51</span>:<span class="number">19</span></span><br><span class="line"></span><br><span class="line">SUMMARY: AddressSanitizer: heap-buffer-<span class="built_in">overflow</span> (/home/osaa/桌面/fuzz/fuzzing_tiff/install/bin/tiffinfo+<span class="number">0x614e0</span>) (BuildId: <span class="number">09</span>ddfdfe67d478d303d725e7968d407c632d1072) in fputs</span><br><span class="line">Shadow bytes around the buggy address:</span><br><span class="line">  <span class="number">0x0c047fff7fb0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0c047fff7fc0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0c047fff7fd0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0c047fff7fe0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0c047fff7ff0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">=&gt;<span class="number">0x0c047fff8000</span>: fa fa <span class="number">00</span> <span class="number">00</span> fa fa fd fa fa fa fd fa fa fa[<span class="number">01</span>]fa</span><br><span class="line">  <span class="number">0x0c047fff8010</span>: fa fa fd fa fa fa fd fa fa fa fd fa fa fa fd fa</span><br><span class="line">  <span class="number">0x0c047fff8020</span>: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa</span><br><span class="line">  <span class="number">0x0c047fff8030</span>: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa</span><br><span class="line">  <span class="number">0x0c047fff8040</span>: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa</span><br><span class="line">  <span class="number">0x0c047fff8050</span>: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa</span><br><span class="line">Shadow byte <span class="built_in">legend</span> (one shadow byte represents <span class="number">8</span> application bytes):</span><br><span class="line">  Addressable:           <span class="number">00</span></span><br><span class="line">  Partially addressable: <span class="number">01</span> <span class="number">02</span> <span class="number">03</span> <span class="number">04</span> <span class="number">05</span> <span class="number">06</span> <span class="number">07</span> </span><br><span class="line">  Heap left redzone:       fa</span><br><span class="line">  Freed heap region:       fd</span><br><span class="line">  Stack left redzone:      f1</span><br><span class="line">  Stack mid redzone:       f2</span><br><span class="line">  Stack right redzone:     f3</span><br><span class="line">  Stack after <span class="keyword">return</span>:      f5</span><br><span class="line">  Stack use after scope:   f8</span><br><span class="line">  Global redzone:          f9</span><br><span class="line">  Global init order:       f6</span><br><span class="line">  Poisoned by user:        f7</span><br><span class="line">  Container overflow:      fc</span><br><span class="line">  Array cookie:            ac</span><br><span class="line">  Intra object redzone:    bb</span><br><span class="line">  ASan internal:           fe</span><br><span class="line">  Left alloca redzone:     ca</span><br><span class="line">  Right alloca redzone:    cb</span><br><span class="line">==<span class="number">2688234</span>==ABORTING</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Fuzzing101-tiff"><a href="#Fuzzing101-tiff" class="headerlink" title="Fuzzing101 - tiff"></a>Fuzzing101 - tiff</h3><p>本次练习在之前的基础上，教会了我们使用lcov来查看代码覆盖率，调整fuzz的覆盖和变异种子，记住使用lcov之前要调整环境变量export LDFLAGS&#x3D;”–coverage”   export CFLAGS&#x3D;”–coverage” make clean以后重新make</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo su</span><br><span class="line">echo core &gt;/proc/sys/kernel/core_pattern</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>

<p>调整崩溃处理后进行fuzz，之后可以看到由于我fuzz了3分钟就停止了 覆盖率是很低的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Current view: 	top level 			Hit 	Total 	Coverage</span><br><span class="line">Test: 	        app2.info 		    Lines: 	1229 	11796 	10.4 %</span><br><span class="line">Date: 	    2023-02-27 16:09:56 		Functions: 	91 	560 	16.2 %</span><br><span class="line">Legend: 	Rating: low: &lt; 75 % medium: &gt;= 75 % high: &gt;= 90 % 	</span><br><span class="line"></span><br><span class="line">					</span><br><span class="line">Directory Sort by name 	Line Coverage Sort by line coverage 	Functions Sort by function coverage</span><br><span class="line">libtiff 	                10.0%10.0%       10.0 % 	1159 / 11545 	15.9 % 	87 / 546</span><br><span class="line">tools 	                     27.9%27.9        27.9 % 	70 / 251 	28.6 % 	4 / 14</span><br><span class="line"></span><br><span class="line">Generated by: LCOV version 1.16</span><br></pre></td></tr></table></figure>

<h3 id="Fuzzing101-libxml"><a href="#Fuzzing101-libxml" class="headerlink" title="Fuzzing101 - libxml"></a>Fuzzing101 - libxml</h3><p>本次练习学习了使用字典进行fuzz和多核并行测试</p>
<p>记录一下指令-M指定一个主实例fuzzer -D启用确定性突变 （只适用于主实例fuzzer） -S指定其他fuzzer  -x指定字典路径 –valid参数捕捉错误</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+++++fuzz1++++</span><br><span class="line">/home/osaa/桌面/fuzz/AFLplusplus/afl-fuzz -m none -i /home/osaa/桌面/fuzz/fuzzing_libXML2/afl_in -o /home/osaa/桌面/fuzz/fuzzing_libXML2/afl_out -s 123 -x /home/osaa/桌面/fuzz/fuzzing_libXML2/dictionaries/xml.dict -D -M osaa_fuzzer1 -- /home/osaa/桌面/fuzz/fuzzing_libXML2/install/bin/xmllint --memory --noenc --nocdata --dtdattr --loaddtd --valid --xinclude @@</span><br><span class="line">+++++fuzz2+++++</span><br><span class="line">/home/osaa/桌面/fuzz/AFLplusplus/afl-fuzz -m none -i /home/osaa/桌面/fuzz/fuzzing_libXML2/afl_in -o /home/osaa/桌面/fuzz/fuzzing_libXML2/afl_out -s 234 -S osaa_fuzzer2 -- /home/osaa/桌面/fuzz/fuzzing_libXML2/install/bin/xmllint --memory --noenc --nocdata --dtdattr --loaddtd --valid --xinclude @@ </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">#########################FUZZ1###################################<span class="meta">#</span></span><br><span class="line"><span class="meta"> american fuzzy lop ++4.06a &#123;osaa_fuzzer1&#125; (...L2/install/bin/xmllint) [fast]</span></span><br><span class="line">┌─ process timing ────────────────────────────────────┬─ overall results ────┐</span><br><span class="line">│        run time : <span class="number">0</span> days, <span class="number">0</span> hrs, <span class="number">3</span> min, <span class="number">2</span> sec       │  cycles done : <span class="number">0</span>     │</span><br><span class="line">│   last <span class="keyword">new</span> find : <span class="number">0</span> days, <span class="number">0</span> hrs, <span class="number">0</span> min, <span class="number">17</span> sec      │ corpus count : <span class="number">88</span>    │</span><br><span class="line">│last saved crash : none seen yet                     │saved crashes : <span class="number">0</span>     │</span><br><span class="line">│ last saved hang : none seen yet                     │  saved hangs : <span class="number">0</span>     │</span><br><span class="line">├─ cycle progress ─────────────────────┬─ map coverage┴──────────────────────┤</span><br><span class="line">│  now processing : <span class="number">2.0</span> (<span class="number">2.3</span>%)         │    map density : <span class="number">0.88</span>% / <span class="number">1.16</span>%      │</span><br><span class="line">│  runs timed out : <span class="number">0</span> (<span class="number">0.00</span>%)          │ count coverage : <span class="number">1.16</span> bits/tuple    │</span><br><span class="line">├─ stage progress ─────────────────────┼─ findings in depth ─────────────────┤</span><br><span class="line">│  now trying : arith <span class="number">8</span>/<span class="number">8</span>              │ favored items : <span class="number">11</span> (<span class="number">12.50</span>%)         │</span><br><span class="line">│ stage execs : <span class="number">13.4</span>k/<span class="number">283</span>k (<span class="number">4.71</span>%)     │  <span class="keyword">new</span> edges on : <span class="number">19</span> (<span class="number">21.59</span>%)         │</span><br><span class="line">│ total execs : <span class="number">149</span>k                   │ total crashes : <span class="number">0</span> (<span class="number">0</span> saved)         │</span><br><span class="line">│  exec speed : <span class="number">753.0</span>/sec              │  total tmouts : <span class="number">0</span> (<span class="number">0</span> saved)         │</span><br><span class="line">├─ fuzzing strategy yields ────────────┴─────────────┬─ item geometry ───────┤</span><br><span class="line">│   bit flips : <span class="number">0</span>/<span class="number">40.9</span>k, <span class="number">3</span>/<span class="number">40.9</span>k, <span class="number">1</span>/<span class="number">40.9</span>k            │    levels : <span class="number">2</span>         │</span><br><span class="line">│  byte flips : <span class="number">0</span>/<span class="number">5107</span>, <span class="number">0</span>/<span class="number">4099</span>, <span class="number">0</span>/<span class="number">4099</span>               │   pending : <span class="number">33</span>        │</span><br><span class="line">│ arithmetics : <span class="number">0</span>/<span class="number">0</span>, <span class="number">0</span>/<span class="number">0</span>, <span class="number">0</span>/<span class="number">0</span>                        │  pend fav : <span class="number">11</span>        │</span><br><span class="line">│  known ints : <span class="number">0</span>/<span class="number">0</span>, <span class="number">0</span>/<span class="number">0</span>, <span class="number">0</span>/<span class="number">0</span>                        │ own finds : <span class="number">9</span>         │</span><br><span class="line">│  dictionary : <span class="number">0</span>/<span class="number">0</span>, <span class="number">0</span>/<span class="number">0</span>, <span class="number">0</span>/<span class="number">0</span>, <span class="number">0</span>/<span class="number">0</span>                   │  imported : <span class="number">0</span>         │</span><br><span class="line">│havoc/splice : <span class="number">0</span>/<span class="number">0</span>, <span class="number">0</span>/<span class="number">0</span>                             │ stability : <span class="number">100.00</span>%   │</span><br><span class="line">│py/custom/rq : unused, unused, unused, unused       ├───────────────────────┘</span><br><span class="line">│    trim/eff : disabled, <span class="number">99.53</span>%                     │          [cpu000:<span class="number">100</span>%]</span><br><span class="line">└────────────────────────────────────────────────────┘^C</span><br><span class="line">                                                                                       </span><br><span class="line">+++ Testing aborted by user +++                                                        </span><br><span class="line">[+] We<span class="number">&#x27;</span>re done here. Have a nice day!      </span><br><span class="line"></span><br><span class="line">++++++++++++++++++FUZZ2++++++++++++++++++++++++++++++++++++++</span><br><span class="line">american fuzzy lop ++<span class="number">4.06</span>a &#123;osaa_fuzzer2&#125; (...L2/install/bin/xmllint) [fast]</span><br><span class="line">┌─ process timing ────────────────────────────────────┬─ overall results ────┐</span><br><span class="line">│        run time : <span class="number">0</span> days, <span class="number">0</span> hrs, <span class="number">2</span> min, <span class="number">32</span> sec      │  cycles done : <span class="number">0</span>     │</span><br><span class="line">│   last <span class="keyword">new</span> find : <span class="number">0</span> days, <span class="number">0</span> hrs, <span class="number">0</span> min, <span class="number">2</span> sec       │ corpus count : <span class="number">651</span>   │</span><br><span class="line">│last saved crash : none seen yet                     │saved crashes : <span class="number">0</span>     │</span><br><span class="line">│ last saved hang : none seen yet                     │  saved hangs : <span class="number">0</span>     │</span><br><span class="line">├─ cycle progress ─────────────────────┬─ map coverage┴──────────────────────┤</span><br><span class="line">│  now processing : <span class="number">441.1</span> (<span class="number">67.7</span>%)      │    map density : <span class="number">1.14</span>% / <span class="number">2.53</span>%      │</span><br><span class="line">│  runs timed out : <span class="number">0</span> (<span class="number">0.00</span>%)          │ count coverage : <span class="number">2.44</span> bits/tuple    │</span><br><span class="line">├─ stage progress ─────────────────────┼─ findings in depth ─────────────────┤</span><br><span class="line">│  now trying : havoc                  │ favored items : <span class="number">157</span> (<span class="number">24.12</span>%)        │</span><br><span class="line">│ stage execs : <span class="number">14.7</span>k/<span class="number">25.6</span>k (<span class="number">57.51</span>%)   │  <span class="keyword">new</span> edges on : <span class="number">234</span> (<span class="number">35.94</span>%)        │</span><br><span class="line">│ total execs : <span class="number">120</span>k                   │ total crashes : <span class="number">0</span> (<span class="number">0</span> saved)         │</span><br><span class="line">│  exec speed : <span class="number">893.0</span>/sec              │  total tmouts : <span class="number">0</span> (<span class="number">0</span> saved)         │</span><br><span class="line">├─ fuzzing strategy yields ────────────┴─────────────┬─ item geometry ───────┤</span><br><span class="line">│   bit flips : <span class="built_in">disabled</span> (<span class="keyword">default</span>, enable with -D)   │    levels : <span class="number">4</span>         │</span><br><span class="line">│  byte flips : <span class="built_in">disabled</span> (<span class="keyword">default</span>, enable with -D)   │   pending : <span class="number">588</span>       │</span><br><span class="line">│ arithmetics : <span class="built_in">disabled</span> (<span class="keyword">default</span>, enable with -D)   │  pend fav : <span class="number">153</span>       │</span><br><span class="line">│  known ints : <span class="built_in">disabled</span> (<span class="keyword">default</span>, enable with -D)   │ own finds : <span class="number">569</span>       │</span><br><span class="line">│  dictionary : n/a                                  │  imported : <span class="number">3</span>         │</span><br><span class="line">│havoc/splice : <span class="number">324</span>/<span class="number">78.4</span>k, <span class="number">231</span>/<span class="number">21.5</span>k                 │ stability : <span class="number">100.00</span>%   │</span><br><span class="line">│py/custom/rq : unused, unused, unused, unused       ├───────────────────────┘</span><br><span class="line">│    trim/eff : <span class="number">21.20</span>%/<span class="number">1035</span>, disabled                │          [cpu001: <span class="number">75</span>%]</span><br><span class="line">└────────────────────────────────────────────────────┘^C</span><br><span class="line"></span><br><span class="line">+++ Testing aborted by user +++</span><br><span class="line">[+] We<span class="number">&#x27;</span>re done here. Have a nice day!</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="ASAN代码分析"><a href="#ASAN代码分析" class="headerlink" title="ASAN代码分析"></a>ASAN代码分析</h2><p>上面的lab也提到了ASAN，但是具体是什么呢？实际编写一个栈溢出的例子，直接看结果</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">=================================================================</span><br><span class="line">==<span class="number">3116373</span>==ERROR: AddressSanitizer: stack-buffer-overflow on address <span class="number">0x7ffdd404f9b4</span> at pc </span><br><span class="line">   #可以看到ASAN给我们定位到了栈溢出地址在<span class="number">0x7ffdd404f9b4</span>，同时也给了bp，sp的值</span><br><span class="line">   <span class="number">0x55d2ab84708d</span> bp <span class="number">0x7ffdd404f7f0</span> sp <span class="number">0x7ffdd404f7e8</span>                                                                                                                                    </span><br><span class="line">READ of size <span class="number">4</span> at <span class="number">0x7ffdd404f9b4</span> thread T0                                                                                              </span><br><span class="line">    #<span class="number">0</span> <span class="number">0x55d2ab84708c</span> in main /home/osaa/桌面/fuzz/asan_lab/stackover.cpp:<span class="number">4</span>:<span class="number">10</span></span><br><span class="line">    #<span class="number">1</span> <span class="number">0x7f2f7af6f189</span> in __libc_start_call_main csu/../sysdeps/nptl/libc_start_call_main.h:<span class="number">58</span>:<span class="number">16</span></span><br><span class="line">    #<span class="number">2</span> <span class="number">0x7f2f7af6f244</span> in __libc_start_main csu/../csu/libc-start.c:<span class="number">381</span>:<span class="number">3</span></span><br><span class="line">    #<span class="number">3</span> <span class="number">0x55d2ab789300</span> in _start (/home/osaa/桌面/fuzz/asan_lab/stackover+<span class="number">0x20300</span>) (BuildId: <span class="number">70598e6</span>f1fc76855f20289da2c89caf8155ace14)</span><br><span class="line">#还表示了采用read操作和给了函数栈</span><br><span class="line">Address <span class="number">0x7ffdd404f9b4</span> is located in stack of thread T0 at offset <span class="number">436</span> in frame</span><br><span class="line">    #<span class="number">0</span> <span class="number">0x55d2ab846eaf</span> in main /home/osaa/桌面/fuzz/asan_lab/stackover.cpp:<span class="number">1</span></span><br><span class="line">#标记漏洞在溢出的地址（<span class="number">0x7ffdd404f9b4</span>）偏移<span class="number">436</span>处</span><br><span class="line">  This frame has <span class="number">1</span> <span class="built_in">object</span>(s):</span><br><span class="line">    [<span class="number">32</span>, <span class="number">432</span>) <span class="string">&#x27;osaa&#x27;</span> (line <span class="number">2</span>) &lt;== Memory access at offset <span class="number">436</span> overflows <span class="keyword">this</span> variable</span><br><span class="line">HINT: <span class="keyword">this</span> may be a <span class="literal">false</span> positive <span class="keyword">if</span> your program uses some custom stack unwind mechanism, swapcontext <span class="keyword">or</span> <span class="built_in">vfork</span></span><br><span class="line">      (longjmp <span class="keyword">and</span> C++ exceptions *are* supported)</span><br><span class="line">SUMMARY: AddressSanitizer: stack-buffer-overflow /home/osaa/桌面/fuzz/asan_lab/stackover.cpp:<span class="number">4</span>:<span class="number">10</span> in main</span><br><span class="line">Shadow bytes around the buggy address:</span><br><span class="line">  <span class="number">0x10003a801ee0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x10003a801ef0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x10003a801f00</span>: f1 f1 f1 f1 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x10003a801f10</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x10003a801f20</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">=&gt;<span class="number">0x10003a801f30</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>[f3]f3 f3 f3 f3 f3 f3 f3 f3 f3</span><br><span class="line">  <span class="number">0x10003a801f40</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x10003a801f50</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x10003a801f60</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x10003a801f70</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x10003a801f80</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">Shadow byte <span class="built_in">legend</span> (one shadow byte represents <span class="number">8</span> application bytes):</span><br><span class="line">  Addressable:           <span class="number">00</span></span><br><span class="line">  Partially addressable: <span class="number">01</span> <span class="number">02</span> <span class="number">03</span> <span class="number">04</span> <span class="number">05</span> <span class="number">06</span> <span class="number">07</span> </span><br><span class="line">  Heap left redzone:       fa</span><br><span class="line">  Freed heap region:       fd</span><br><span class="line">  Stack left redzone:      f1</span><br><span class="line">  Stack mid redzone:       f2</span><br><span class="line">  Stack right redzone:     f3</span><br><span class="line">  Stack after <span class="keyword">return</span>:      f5</span><br><span class="line">  Stack use after scope:   f8</span><br><span class="line">  Global redzone:          f9</span><br><span class="line">  Global init order:       f6</span><br><span class="line">  Poisoned by user:        f7</span><br><span class="line">  Container overflow:      fc</span><br><span class="line">  Array cookie:            ac</span><br><span class="line">  Intra object redzone:    bb</span><br><span class="line">  ASan internal:           fe</span><br><span class="line">  Left alloca redzone:     ca</span><br><span class="line">  Right alloca redzone:    cb</span><br><span class="line">==<span class="number">3116373</span>==ABORTING</span><br><span class="line">     #这一部分给出了一个内存中的示意图</span><br><span class="line">                          </span><br></pre></td></tr></table></figure>

<p>下面试全局变量的情况，同样的道理我们也可以分析到在0x55d8fd970cf4发生了全局变量复用溢出</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">==<span class="number">3118611</span>==ERROR: AddressSanitizer: global-buffer-overflow on address <span class="number">0x55d8fd970cf4</span> at pc <span class="number">0x55d8fd93bedc</span> bp <span class="number">0x7fff2488bba0</span> sp <span class="number">0x7fff2488bb98</span>                                                                                                     </span><br><span class="line">READ of size <span class="number">4</span> at <span class="number">0x55d8fd970cf4</span> thread T0                                                                               </span><br><span class="line">    #<span class="number">0</span> <span class="number">0x55d8fd93bedb</span> in main /home/osaa/桌面/fuzz/asan_lab/global_buf_ex.cpp:<span class="number">4</span>:<span class="number">10</span></span><br><span class="line">    #<span class="number">1</span> <span class="number">0x7fcefdc2d189</span> in __libc_start_call_main csu/../sysdeps/nptl/libc_start_call_main.h:<span class="number">58</span>:<span class="number">16</span></span><br><span class="line">    #<span class="number">2</span> <span class="number">0x7fcefdc2d244</span> in __libc_start_main csu/../csu/libc-start.c:<span class="number">381</span>:<span class="number">3</span></span><br><span class="line">    #<span class="number">3</span> <span class="number">0x55d8fd87e300</span> in _start (/home/osaa/桌面/fuzz/asan_lab/global_buf_ex+<span class="number">0x20300</span>) (BuildId: e514f816b4c9a8607c4d2cac83c6aa6c8e736afc)</span><br><span class="line"></span><br><span class="line"><span class="number">0x55d8fd970cf4</span> is located <span class="number">4</span> bytes to the right of global variable <span class="string">&#x27;osaa&#x27;</span> defined in <span class="string">&#x27;global_buf_ex.cpp:2:5&#x27;</span> (<span class="number">0x55d8fd970b60</span>) of size <span class="number">400</span>                                                                                                          </span><br><span class="line">SUMMARY: AddressSanitizer: global-buffer-overflow /home/osaa/桌面/fuzz/asan_lab/global_buf_ex.cpp:<span class="number">4</span>:<span class="number">10</span> in main           </span><br><span class="line">Shadow bytes around the buggy address:</span><br><span class="line">  <span class="number">0x0abb9fb26140</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0abb9fb26150</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0abb9fb26160</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0abb9fb26170</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0abb9fb26180</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">=&gt;<span class="number">0x0abb9fb26190</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>[f9]f9</span><br><span class="line">  <span class="number">0x0abb9fb261a0</span>: f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9 f9</span><br><span class="line">  <span class="number">0x0abb9fb261b0</span>: f9 f9 f9 f9 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0abb9fb261c0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0abb9fb261d0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0abb9fb261e0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">Shadow byte <span class="built_in">legend</span> (one shadow byte represents <span class="number">8</span> application bytes):</span><br><span class="line">  Addressable:           <span class="number">00</span></span><br><span class="line">  Partially addressable: <span class="number">01</span> <span class="number">02</span> <span class="number">03</span> <span class="number">04</span> <span class="number">05</span> <span class="number">06</span> <span class="number">07</span> </span><br><span class="line">  Heap left redzone:       fa</span><br><span class="line">  Freed heap region:       fd</span><br><span class="line">  Stack left redzone:      f1</span><br><span class="line">  Stack mid redzone:       f2</span><br><span class="line">  Stack right redzone:     f3</span><br><span class="line">  Stack after <span class="keyword">return</span>:      f5</span><br><span class="line">  Stack use after scope:   f8</span><br><span class="line">  Global redzone:          f9</span><br><span class="line">  Global init order:       f6</span><br><span class="line">  Poisoned by user:        f7</span><br><span class="line">  Container overflow:      fc</span><br><span class="line">  Array cookie:            ac</span><br><span class="line">  Intra object redzone:    bb</span><br><span class="line">  ASan internal:           fe</span><br><span class="line">  Left alloca redzone:     ca</span><br><span class="line">  Right alloca redzone:    cb</span><br><span class="line">==<span class="number">3118611</span>==ABORTING</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>同样的道理记录一下各种类型的漏洞，下面这个是临时变量在调用函数外被重复使用</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">==<span class="number">3121967</span>==ERROR: AddressSanitizer: stack-use-after-scope on address <span class="number">0x7ffc8dec3ee0</span> at pc <span class="number">0x5601e8037fbe</span> bp <span class="number">0x7ffc8dec3eb0</span> sp <span class="number">0x7ffc8dec3ea8</span>                                                                                                      </span><br><span class="line">WRITE of size <span class="number">4</span> at <span class="number">0x7ffc8dec3ee0</span> thread T0                                                                              </span><br><span class="line">    #<span class="number">0</span> <span class="number">0x5601e8037fbd</span> in main /home/osaa/桌面/fuzz/asan_lab/stack_use_after_sc.cpp:<span class="number">9</span>:<span class="number">6</span></span><br><span class="line">    #<span class="number">1</span> <span class="number">0x7f56074d9189</span> in __libc_start_call_main csu/../sysdeps/nptl/libc_start_call_main.h:<span class="number">58</span>:<span class="number">16</span></span><br><span class="line">    #<span class="number">2</span> <span class="number">0x7f56074d9244</span> in __libc_start_main csu/../csu/libc-start.c:<span class="number">381</span>:<span class="number">3</span></span><br><span class="line">    #<span class="number">3</span> <span class="number">0x5601e7f7a300</span> in _start (/home/osaa/桌面/fuzz/asan_lab/stack_use_after_sc+<span class="number">0x20300</span>) (BuildId: ddeb341fa724c7fc4aaf3a36d7181f1af9aaeabc)</span><br><span class="line"></span><br><span class="line">Address <span class="number">0x7ffc8dec3ee0</span> is located in stack of thread T0 at offset <span class="number">32</span> in frame</span><br><span class="line">    #<span class="number">0</span> <span class="number">0x5601e8037eaf</span> in main /home/osaa/桌面/fuzz/asan_lab/stack_use_after_sc.cpp:<span class="number">4</span></span><br><span class="line"></span><br><span class="line">  This frame has <span class="number">1</span> <span class="built_in">object</span>(s):</span><br><span class="line">    [<span class="number">32</span>, <span class="number">36</span>) <span class="string">&#x27;osaa&#x27;</span> (line <span class="number">6</span>) &lt;== Memory access at offset <span class="number">32</span> is inside <span class="keyword">this</span> variable</span><br><span class="line">HINT: <span class="keyword">this</span> may be a <span class="literal">false</span> positive <span class="keyword">if</span> your program uses some custom stack unwind mechanism, swapcontext <span class="keyword">or</span> <span class="built_in">vfork</span></span><br><span class="line">      (longjmp <span class="keyword">and</span> C++ exceptions *are* supported)</span><br><span class="line">SUMMARY: AddressSanitizer: stack-use-after-scope /home/osaa/桌面/fuzz/asan_lab/stack_use_after_sc.cpp:<span class="number">9</span>:<span class="number">6</span> in main</span><br><span class="line">Shadow bytes around the buggy address:</span><br><span class="line">  <span class="number">0x100011bd0780</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x100011bd0790</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x100011bd07a0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x100011bd07b0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x100011bd07c0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">=&gt;<span class="number">0x100011bd07d0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> f1 f1 f1 f1[f8]f3 f3 f3</span><br><span class="line">  <span class="number">0x100011bd07e0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x100011bd07f0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x100011bd0800</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x100011bd0810</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x100011bd0820</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">Shadow byte <span class="built_in">legend</span> (one shadow byte represents <span class="number">8</span> application bytes):</span><br><span class="line">  Addressable:           <span class="number">00</span></span><br><span class="line">  Partially addressable: <span class="number">01</span> <span class="number">02</span> <span class="number">03</span> <span class="number">04</span> <span class="number">05</span> <span class="number">06</span> <span class="number">07</span> </span><br><span class="line">  Heap left redzone:       fa</span><br><span class="line">  Freed heap region:       fd</span><br><span class="line">  Stack left redzone:      f1</span><br><span class="line">  Stack mid redzone:       f2</span><br><span class="line">  Stack right redzone:     f3</span><br><span class="line">  Stack after <span class="keyword">return</span>:      f5</span><br><span class="line">  Stack use after scope:   f8</span><br><span class="line">  Global redzone:          f9</span><br><span class="line">  Global init order:       f6</span><br><span class="line">  Poisoned by user:        f7</span><br><span class="line">  Container overflow:      fc</span><br><span class="line">  Array cookie:            ac</span><br><span class="line">  Intra object redzone:    bb</span><br><span class="line">  ASan internal:           fe</span><br><span class="line">  Left alloca redzone:     ca</span><br><span class="line">  Right alloca redzone:    cb</span><br><span class="line">==<span class="number">3121967</span>==ABORTING</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>内联函数标记为非内联函数时，出现类似stack_use_after_scope的漏洞</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">=================================================================</span><br><span class="line">==<span class="number">3128767</span>==ERROR: AddressSanitizer: stack-use-after-<span class="keyword">return</span> on address <span class="number">0x7f5e6c000024</span> at pc <span class="number">0x55b0a492f06c</span> bp <span class="number">0x7fffa9f65d40</span> sp <span class="number">0x7fffa9f65d38</span></span><br><span class="line">READ of size <span class="number">4</span> at <span class="number">0x7f5e6c000024</span> thread T0</span><br><span class="line">    #<span class="number">0</span> <span class="number">0x55b0a492f06b</span> in main /home/osaa/桌面/fuzz/asan_lab/stack_after_return.cpp:<span class="number">12</span>:<span class="number">10</span></span><br><span class="line">    #<span class="number">1</span> <span class="number">0x7f5e6db2b189</span> in __libc_start_call_main csu/../sysdeps/nptl/libc_start_call_main.h:<span class="number">58</span>:<span class="number">16</span></span><br><span class="line">    #<span class="number">2</span> <span class="number">0x7f5e6db2b244</span> in __libc_start_main csu/../csu/libc-start.c:<span class="number">381</span>:<span class="number">3</span></span><br><span class="line">    #<span class="number">3</span> <span class="number">0x55b0a4871300</span> in _start (/home/osaa/桌面/fuzz/asan_lab/stack_use_after_return+<span class="number">0x20300</span>) (BuildId: <span class="number">17029</span>a1a9d90225c3fcd1f3ca22844d46ab77b87)</span><br><span class="line"></span><br><span class="line">Address <span class="number">0x7f5e6c000024</span> is located in stack of thread T0 at offset <span class="number">36</span> in frame</span><br><span class="line">    #<span class="number">0</span> <span class="number">0x55b0a492eeaf</span> in <span class="built_in">FunctionA</span>() /home/osaa/桌面/fuzz/asan_lab/stack_after_return.cpp:<span class="number">5</span></span><br><span class="line"></span><br><span class="line">  This frame has <span class="number">1</span> <span class="built_in">object</span>(s):</span><br><span class="line">    [<span class="number">32</span>, <span class="number">432</span>) <span class="string">&#x27;osaa&#x27;</span> (line <span class="number">6</span>) &lt;== Memory access at offset <span class="number">36</span> is inside <span class="keyword">this</span> variable</span><br><span class="line">HINT: <span class="keyword">this</span> may be a <span class="literal">false</span> positive <span class="keyword">if</span> your program uses some custom stack unwind mechanism, swapcontext <span class="keyword">or</span> <span class="built_in">vfork</span></span><br><span class="line">      (longjmp <span class="keyword">and</span> C++ exceptions *are* supported)</span><br><span class="line">SUMMARY: AddressSanitizer: stack-use-after-<span class="keyword">return</span> /home/osaa/桌面/fuzz/asan_lab/stack_after_return.cpp:<span class="number">12</span>:<span class="number">10</span> in main</span><br><span class="line">Shadow bytes around the buggy address:</span><br><span class="line">  <span class="number">0x0fec4d7f7fb0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0fec4d7f7fc0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0fec4d7f7fd0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0fec4d7f7fe0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0fec4d7f7ff0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">=&gt;<span class="number">0x0fec4d7f8000</span>: f5 f5 f5 f5[f5]f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5</span><br><span class="line">  <span class="number">0x0fec4d7f8010</span>: f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5</span><br><span class="line">  <span class="number">0x0fec4d7f8020</span>: f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5</span><br><span class="line">  <span class="number">0x0fec4d7f8030</span>: f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5</span><br><span class="line">  <span class="number">0x0fec4d7f8040</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0fec4d7f8050</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">Shadow byte <span class="built_in">legend</span> (one shadow byte represents <span class="number">8</span> application bytes):</span><br><span class="line">  Addressable:           <span class="number">00</span></span><br><span class="line">  Partially addressable: <span class="number">01</span> <span class="number">02</span> <span class="number">03</span> <span class="number">04</span> <span class="number">05</span> <span class="number">06</span> <span class="number">07</span> </span><br><span class="line">  Heap left redzone:       fa</span><br><span class="line">  Freed heap region:       fd</span><br><span class="line">  Stack left redzone:      f1</span><br><span class="line">  Stack mid redzone:       f2</span><br><span class="line">  Stack right redzone:     f3</span><br><span class="line">  Stack after <span class="keyword">return</span>:      f5</span><br><span class="line">  Stack use after scope:   f8</span><br><span class="line">  Global redzone:          f9</span><br><span class="line">  Global init order:       f6</span><br><span class="line">  Poisoned by user:        f7</span><br><span class="line">  Container overflow:      fc</span><br><span class="line">  Array cookie:            ac</span><br><span class="line">  Intra object redzone:    bb</span><br><span class="line">  ASan internal:           fe</span><br><span class="line">  Left alloca redzone:     ca</span><br><span class="line">  Right alloca redzone:    cb</span><br><span class="line">==<span class="number">3128767</span>==ABORTING</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>下面是heap中的越界</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">=================================================================</span><br><span class="line">==<span class="number">3132691</span>==ERROR: AddressSanitizer: heap-buffer-overflow on address <span class="number">0x6140000001d4</span> at pc <span class="number">0x5608f3bcf1fd</span> bp <span class="number">0x7ffda8f2f3b0</span> sp <span class="number">0x7ffda8f2f3a8</span>                                                                                                       </span><br><span class="line">READ of size <span class="number">4</span> at <span class="number">0x6140000001d4</span> thread T0                                                                               </span><br><span class="line">    #<span class="number">0</span> <span class="number">0x5608f3bcf1fc</span> in main /home/osaa/桌面/fuzz/asan_lab/uaf.cpp:<span class="number">5</span></span><br><span class="line">    #<span class="number">1</span> <span class="number">0x7f9a24c46189</span> in __libc_start_call_main ../sysdeps/nptl/libc_start_call_main.h:<span class="number">58</span></span><br><span class="line">    #<span class="number">2</span> <span class="number">0x7f9a24c46244</span> in __libc_start_main_impl ../csu/libc-start.c:<span class="number">381</span></span><br><span class="line">    #<span class="number">3</span> <span class="number">0x5608f3bcf0c0</span> in _start (/home/osaa/桌面/fuzz/asan_lab/uaf+<span class="number">0x10c0</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">0x6140000001d4</span> is located <span class="number">4</span> bytes to the right of <span class="number">400</span>-byte region [<span class="number">0x614000000040</span>,<span class="number">0x6140000001d0</span>)</span><br><span class="line">allocated by thread T0 here:                                                                                             </span><br><span class="line">    #<span class="number">0</span> <span class="number">0x7f9a24eb00c7</span> in <span class="keyword">operator</span> <span class="keyword">new</span>[](<span class="type">unsigned</span> <span class="type">long</span>) ../../../../src/libsanitizer/asan/asan_new_delete.cpp:<span class="number">102</span></span><br><span class="line">    #<span class="number">1</span> <span class="number">0x5608f3bcf195</span> in main /home/osaa/桌面/fuzz/asan_lab/uaf.cpp:<span class="number">3</span></span><br><span class="line"></span><br><span class="line">SUMMARY: AddressSanitizer: heap-buffer-overflow /home/osaa/桌面/fuzz/asan_lab/uaf.cpp:<span class="number">5</span> in main</span><br><span class="line">Shadow bytes around the buggy address:</span><br><span class="line">  <span class="number">0x0c287fff7fe0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0c287fff7ff0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0c287fff8000</span>: fa fa fa fa fa fa fa fa <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0c287fff8010</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0c287fff8020</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">=&gt;<span class="number">0x0c287fff8030</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>[fa]fa fa fa fa fa</span><br><span class="line">  <span class="number">0x0c287fff8040</span>: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa</span><br><span class="line">  <span class="number">0x0c287fff8050</span>: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa</span><br><span class="line">  <span class="number">0x0c287fff8060</span>: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa</span><br><span class="line">  <span class="number">0x0c287fff8070</span>: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa</span><br><span class="line">  <span class="number">0x0c287fff8080</span>: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa</span><br><span class="line">Shadow byte <span class="built_in">legend</span> (one shadow byte represents <span class="number">8</span> application bytes):</span><br><span class="line">  Addressable:           <span class="number">00</span></span><br><span class="line">  Partially addressable: <span class="number">01</span> <span class="number">02</span> <span class="number">03</span> <span class="number">04</span> <span class="number">05</span> <span class="number">06</span> <span class="number">07</span> </span><br><span class="line">  Heap left redzone:       fa</span><br><span class="line">  Freed heap region:       fd</span><br><span class="line">  Stack left redzone:      f1</span><br><span class="line">  Stack mid redzone:       f2</span><br><span class="line">  Stack right redzone:     f3</span><br><span class="line">  Stack after <span class="keyword">return</span>:      f5</span><br><span class="line">  Stack use after scope:   f8</span><br><span class="line">  Global redzone:          f9</span><br><span class="line">  Global init order:       f6</span><br><span class="line">  Poisoned by user:        f7</span><br><span class="line">  Container overflow:      fc</span><br><span class="line">  Array cookie:            ac</span><br><span class="line">  Intra object redzone:    bb</span><br><span class="line">  ASan internal:           fe</span><br><span class="line">  Left alloca redzone:     ca</span><br><span class="line">  Right alloca redzone:    cb</span><br><span class="line">  Shadow gap:              cc</span><br><span class="line">==<span class="number">3132691</span>==ABORTING</span><br><span class="line">                        </span><br></pre></td></tr></table></figure>

<p>下面是pwn手们最熟悉uaf漏洞</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">==<span class="number">3133335</span>==ERROR: AddressSanitizer: heap-use-after-free on address <span class="number">0x614000000044</span> at pc <span class="number">0x55f3fd3f41cb</span> bp <span class="number">0x7fff942f74c0</span> sp <span class="number">0x7fff942f74b8</span>                                                                                                        </span><br><span class="line">READ of size <span class="number">4</span> at <span class="number">0x614000000044</span> thread T0                                                                               </span><br><span class="line">    #<span class="number">0</span> <span class="number">0x55f3fd3f41ca</span> in main /home/osaa/桌面/fuzz/asan_lab/uaf.cpp:<span class="number">5</span></span><br><span class="line">    #<span class="number">1</span> <span class="number">0x7fecac046189</span> in __libc_start_call_main ../sysdeps/nptl/libc_start_call_main.h:<span class="number">58</span></span><br><span class="line">    #<span class="number">2</span> <span class="number">0x7fecac046244</span> in __libc_start_main_impl ../csu/libc-start.c:<span class="number">381</span></span><br><span class="line">    #<span class="number">3</span> <span class="number">0x55f3fd3f40b0</span> in _start (/home/osaa/桌面/fuzz/asan_lab/uaf+<span class="number">0x10b0</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">0x614000000044</span> is located <span class="number">4</span> bytes inside of <span class="number">400</span>-byte region [<span class="number">0x614000000040</span>,<span class="number">0x6140000001d0</span>)</span><br><span class="line">freed by thread T0 here:                                                                                                 </span><br><span class="line">    #<span class="number">0</span> <span class="number">0x7fecac2b0a87</span> in <span class="keyword">operator</span> <span class="keyword">delete</span>[](<span class="type">void</span>*) ../../../../src/libsanitizer/asan/asan_new_delete.cpp:<span class="number">163</span></span><br><span class="line">    #<span class="number">1</span> <span class="number">0x55f3fd3f4195</span> in main /home/osaa/桌面/fuzz/asan_lab/uaf.cpp:<span class="number">4</span></span><br><span class="line"></span><br><span class="line">previously allocated by thread T0 here:</span><br><span class="line">    #<span class="number">0</span> <span class="number">0x7fecac2b00c7</span> in <span class="keyword">operator</span> <span class="keyword">new</span>[](<span class="type">unsigned</span> <span class="type">long</span>) ../../../../src/libsanitizer/asan/asan_new_delete.cpp:<span class="number">102</span></span><br><span class="line">    #<span class="number">1</span> <span class="number">0x55f3fd3f418a</span> in main /home/osaa/桌面/fuzz/asan_lab/uaf.cpp:<span class="number">3</span></span><br><span class="line"></span><br><span class="line">SUMMARY: AddressSanitizer: heap-use-after-free /home/osaa/桌面/fuzz/asan_lab/uaf.cpp:<span class="number">5</span> in main</span><br><span class="line">Shadow bytes around the buggy address:</span><br><span class="line">  <span class="number">0x0c287fff7fb0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0c287fff7fc0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0c287fff7fd0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0c287fff7fe0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">0x0c287fff7ff0</span>: <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span></span><br><span class="line">=&gt;<span class="number">0x0c287fff8000</span>: fa fa fa fa fa fa fa fa[fd]fd fd fd fd fd fd fd</span><br><span class="line">  <span class="number">0x0c287fff8010</span>: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd</span><br><span class="line">  <span class="number">0x0c287fff8020</span>: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd</span><br><span class="line">  <span class="number">0x0c287fff8030</span>: fd fd fd fd fd fd fd fd fd fd fa fa fa fa fa fa</span><br><span class="line">  <span class="number">0x0c287fff8040</span>: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa</span><br><span class="line">  <span class="number">0x0c287fff8050</span>: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa</span><br><span class="line">Shadow byte <span class="built_in">legend</span> (one shadow byte represents <span class="number">8</span> application bytes):</span><br><span class="line">  Addressable:           <span class="number">00</span></span><br><span class="line">  Partially addressable: <span class="number">01</span> <span class="number">02</span> <span class="number">03</span> <span class="number">04</span> <span class="number">05</span> <span class="number">06</span> <span class="number">07</span> </span><br><span class="line">  Heap left redzone:       fa</span><br><span class="line">  Freed heap region:       fd</span><br><span class="line">  Stack left redzone:      f1</span><br><span class="line">  Stack mid redzone:       f2</span><br><span class="line">  Stack right redzone:     f3</span><br><span class="line">  Stack after <span class="keyword">return</span>:      f5</span><br><span class="line">  Stack use after scope:   f8</span><br><span class="line">  Global redzone:          f9</span><br><span class="line">  Global init order:       f6</span><br><span class="line">  Poisoned by user:        f7</span><br><span class="line">  Container overflow:      fc</span><br><span class="line">  Array cookie:            ac</span><br><span class="line">  Intra object redzone:    bb</span><br><span class="line">  ASan internal:           fe</span><br><span class="line">  Left alloca redzone:     ca</span><br><span class="line">  Right alloca redzone:    cb</span><br><span class="line">  Shadow gap:              cc</span><br><span class="line">==<span class="number">3133335</span>==ABORTING</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>下面一种是内存泄露漏洞，即一个指针指向一块内容后，指针不在调用，内容停留在堆区无法改变</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">==<span class="number">3134055</span>==ERROR: LeakSanitizer: detected memory leaks</span><br><span class="line">                                                                                                                         </span><br><span class="line">Direct leak of <span class="number">8</span> <span class="built_in">byte</span>(s) in <span class="number">1</span> <span class="built_in">object</span>(s) allocated from:</span><br><span class="line">    #<span class="number">0</span> <span class="number">0x55571255914e</span> in __interceptor_malloc (/home/osaa/桌面/fuzz/asan_lab/mem_leak+<span class="number">0xa314e</span>) (BuildId: <span class="number">2</span>acd876452190a500971caf36fe487f749e427eb)</span><br><span class="line">    #<span class="number">1</span> <span class="number">0x555712593eb8</span> in main /home/osaa/桌面/fuzz/asan_lab/mem_leak.cpp:<span class="number">8</span>:<span class="number">10</span></span><br><span class="line">    #<span class="number">2</span> <span class="number">0x7f9182d8c189</span> in __libc_start_call_main csu/../sysdeps/nptl/libc_start_call_main.h:<span class="number">58</span>:<span class="number">16</span></span><br><span class="line"></span><br><span class="line">SUMMARY: AddressSanitizer: <span class="number">8</span> <span class="built_in">byte</span>(s) leaked in <span class="number">1</span> <span class="built_in">allocation</span>(s).</span><br><span class="line">                                                                    </span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/fuzz/" rel="tag"># fuzz</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/01/28/IO-FILE%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0(updating)/" rel="prev" title="IO_FILE学习笔记(updating)">
      <i class="fa fa-chevron-left"></i> IO_FILE学习笔记(updating)
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/05/23/TinyHttp%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" rel="next" title="TinyHttp源码分析">
      TinyHttp源码分析 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Fuzzing101"><span class="nav-number">1.</span> <span class="nav-text">Fuzzing101</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Fuzzing101-Libexif"><span class="nav-number">1.1.</span> <span class="nav-text">Fuzzing101 Libexif</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Fuzzing101-TCPdump"><span class="nav-number">1.2.</span> <span class="nav-text">Fuzzing101-TCPdump</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Fuzzing101-LibTIFF"><span class="nav-number">1.3.</span> <span class="nav-text">Fuzzing101 - LibTIFF</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Fuzzing101-tiff"><span class="nav-number">1.4.</span> <span class="nav-text">Fuzzing101 - tiff</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Fuzzing101-libxml"><span class="nav-number">1.5.</span> <span class="nav-text">Fuzzing101 - libxml</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ASAN%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="nav-number">2.</span> <span class="nav-text">ASAN代码分析</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Osaa"
      src="/image/cat.png">
  <p class="site-author-name" itemprop="name">Osaa</p>
  <div class="site-description" itemprop="description">Try to do something interesting</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">15</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/sohaah" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;sohaah" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://qm.qq.com/q/rwESyZgdUI" title="QQ → https:&#x2F;&#x2F;qm.qq.com&#x2F;q&#x2F;rwESyZgdUI" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>QQ</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Osaa</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
